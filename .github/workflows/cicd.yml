name: CI/CD Pipeline

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: false
        fetch-depth: 1
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        # Install frontend dependencies
        if [ -f "cc-pap/package.json" ]; then
          cd cc-pap && npm ci --legacy-peer-deps || npm install && cd ..
        fi
        
        # Install backend dependencies
        if [ -f "cc-pap-api/requirements.txt" ]; then
          pip install -r cc-pap-api/requirements.txt
        fi
    
    - name: Lint frontend
      run: |
        if [ -f "cc-pap/package.json" ]; then
          cd cc-pap && npm run lint || echo "⚠️ Linting warnings found (non-blocking)"
        fi
    
    - name: Build frontend
      run: |
        if [ -f "cc-pap/package.json" ]; then
          cd cc-pap && npm run build
        fi
    
    - name: Verify builds
      run: |
        echo "Build verification completed"
        if [ -f "cc-pap/dist/index.html" ]; then
          echo "✅ cc-pap build successful"
        fi
